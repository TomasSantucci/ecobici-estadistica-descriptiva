---
title: "TP Estadística Descriptiva"
author: "Autores: Tomas Santucci y Fernando Silva"
date: '2022-04-27'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# Librerias
library(knitr)
getwd()
#setwd("/home/alumno/Documentos/ecobici-estadistica-descriptiva/")
# leemos el csv de recorridos
recorridos <- read.csv("./recorridos6.csv")
# leemos el csv de usuarios
usuarios <- read.csv("./usuarios6.csv")
# combinamos los csv
bicicletas <- merge(usuarios, recorridos, all = TRUE)
# damos un orden a los dias
dia <- factor(bicicletas$dia, levels = c("Lunes","Martes","Miércoles","Jueves", "Viernes", "Sábado", "Domingo"))
```

###### Introduccion:
Este informe esta destinado a mostrar estadisticamente el uso de las
ecobicis provenientes de la Ciudad Autonoma de Buenos Aires.
  Desde el mismo se podran observar datos Univariados 
y Bivariados para tener una mayor apresiacion de la utilidad de las mismas.

## Análisis univariado

### Variable género (Grafico de Sectores)

``` {r genero, fig.align='center', out.width = "50%"}
var_genero <- function(){
  genero <- table(usuarios$genero_usuario)[2:4]
  
  label <- c("Femenino","Otro","\n\nMasculino")
  porcentajes <- round((genero/sum(genero))*100, digits = 2)
  label <- paste(label,"\n\t",porcentajes,"%")
  color <- c("#FFC09F","#A0CED9","#FFEE93")
  
  pie(
    genero,
    main = "Grafico 1: GENERO DE LOS USUARIOS DE ECOBICI \n CABA 2020",
    labels = label,
    sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
    cex.sub = 0.9,
    col = color
  )
}

var_genero()

```

En el Grafico 1 se puede apreciar que la mayoria de los usuarios de las Ecobicis son Mujeres

### Variable edad (Histograma)

``` {r edad, fig.align = 'center', out.width = "50%"}
edad <- usuarios$edad_usuario
breakpoints <- c(15,20,25,30,35,40,45,50,55,60,72)

# Histograma

hist(edad,breaks = breakpoints, right = TRUE,
     xlim = c(10,80), ylim = c(0,0.05), xlab = "Edad", ylab = "Densidad",
     main = "Grafico 2: EDAD DE LOS USUARIOS DE ECOBICI\nCABA 2020",
     sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
     cex.sub = 0.9,
     col = "pink")

```

``` {r polig, figures-side, out.width = "50%"}

rng_edad <- cut(edad, breakpoints, right = TRUE)
tabla_rng_edad <- table(rng_edad)
n <- sum(tabla_rng_edad)

# Poligono de frecuencias
x <- breakpoints
y <- c(0,tabla_rng_edad)/n
plot(x,y,type="l", xlim = c(15,72), ylim = c(0,0.25),
     main = "Grafico 3: EDAD DE LOS USUARIOS DE ECOBICI\nCABA 2020",
     sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
     cex.sub = 0.9,
     ylab = "Frecuencia relativa", xlab = "Edad",lwd = 1.5)
for (i in seq(0,0.25,by=0.05)) abline(a=i,b=0,lty=2,lwd=0.5)


# Poligono acumulativo
y = cumsum(y)
plot(x,y,type="l", xlim = c(15,72), 
     main = "Grafico 4: EDAD DE LOS USUARIOS DE ECOBICI\nCABA 2020",
     sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
     cex.sub = 0.9,
     ylab = "Frecuencia relativa acumulada", xlab = "Edad", lwd = 1.5)
for (i in seq(0,1,by=0.2)) abline(a=i,b=0,lty=2,lwd=0.5)
```

En el Grafico 2 muestra la variacion del uso del servicio respecto de la
edad de los usuarios.
En el Grafico 3 y 4, se muestra los poligonos de Frecuencias Relativas y
Absolutas de los usuarios respecto de la edad de los mismos.

En el Grafico 3, se puede ver claramente el aumento del uso de las ecobici,
de manera creaciente entre los usuarios cuyas edades van desde 20 a 30 
años y luego va decresiendo a medida que aumenta la edad de los mismos.
En otras palabras los usuarios de entre 20 a 30 años utilizan mas el
servicio, que aquellos usuarios mayores de 30 años.

### Variable dias (Grafico de Barras)

``` {r dias, fig.align='center', out.width = "50%"}
semana <- table(dia)

barplot(semana, main = "Grafico 5: DIA DE LOS RECORRIDOS DE LAS ECOBICI\nCABA 2020",
        sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
        cex.sub = 0.9,
        ylim = c(0,150), col = c("lightblue"))
```

En el Grafico 5 se puede observar que la mayor cantidad de viajes se
efectuan los dias viernes. Se puede suponer que ese dia se efectuan dicha
cantidad de viajes, debido a que es el ultimo dia laboral de la semana
y la mayoria de los usuarios obta por este servicio para poder regresar a 
sus casas a tiempo

### Variable estación de origen (Tabla de Frecuencias mas Grafico de Barras)

``` {r estorigen, fig.align='center', out.width = "50%"}
frecAbs <- table(bicicletas$direccion_estacion_origen)
frecAbs <- sort(frecAbs, decreasing = TRUE)
frecAbs <- frecAbs[1:15]
frecRel <- frecAbs/sum(frecAbs)
frecAbsAcum <- cumsum(frecAbs)
frecRelAcum <- cumsum(frecRel)
frecRel <- round(frecRel, digits = 4)
frecRelAcum <- round(frecRelAcum, digits = 4)

tabla <- cbind(names(frecAbs),frecAbs,frecRel,frecAbsAcum,frecRelAcum)
names = c("Estación", "Frecuencia absoluta","Frecuencia relativa","Frecuencia absoluta acumulada",
          "Frecuencia relativa acumulada")
kable(tabla, caption = "Tabla de frecuencias", col.names = names, row.names = FALSE)

par(mar = c(6,13,4,4))
barplot(
  sort(frecAbs, decreasing = FALSE),
  main = "ESTACIONES DE ORIGEN MAS USADAS DE LAS ECOBICI \nCABA 2020",
  sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
  cex.sub = 0.9,
  horiz = TRUE,
  las = 1,
  xlim = c(0,25),
  cex.names = 0.6,
  col = "pink",
)
par(mar = c(5,4,4,2) + 0.1)
```

## Variable estación de destino

Representamos la estacion de destino con un barplot y adicionalmente mostramos una tabla de las frecuencias del mismo

``` {r estdestino, fig.align='center', out.width = "50%"}
frecAbs <- table(bicicletas$direccion_estacion_destino)
frecAbs <- sort(frecAbs, decreasing = TRUE)
frecAbs <- frecAbs[1:15]
frecRel <- frecAbs/sum(frecAbs)
frecAbsAcum <- cumsum(frecAbs)
frecRelAcum <- cumsum(frecRel)
frecRel <- round(frecRel, digits = 4)
frecRelAcum <- round(frecRelAcum, digits = 4)

tabla <- cbind(names(frecAbs),frecAbs,frecRel,frecAbsAcum,frecRelAcum)
names = c("Estación", "Frecuencia absoluta","Frecuencia relativa","Frecuencia absoluta acumulada",
          "Frecuencia relativa acumulada")
kable(tabla, caption = "Tabla de frecuencias", col.names = names, row.names = FALSE)

par(mar = c(6,14,4,4))
barplot(
  sort(frecAbs, decreasing = FALSE),
  main = "ESTACIONES DESTINO MAS USADAS DE LAS ECOBICI \nCABA 2020",
  sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
  cex.sub = 0.9,
  horiz = TRUE,
  las = 1,
  xlim = c(0,25),
  cex.names = 0.6,
  col = "pink",
)
par(mar = c(5, 4, 4, 2) + 0.1)
```

## Variable distancia

vamos a mostrar la frecuencia de la variable distancia con un boxplot

``` {r distancia, fig.align='center', out.width = "50%"}
distancia <- bicicletas$distancia/1000
distancia <- distancia[distancia<20]
summary(distancia)
boxplot(distancia, horizontal = TRUE, outline = TRUE,
        main = "DISTANCIA DE LOS RECORRIDOS DE ECOBICI\nCABA 2020",
        sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
        cex.sub = 0.9,
        xlab = "Distancia en kilometros", boxfill = "pink")
```

## Variable duración

vamos a mostrar la frecuencia de la variable Duracion con un Boxplot

``` {r duración, fig.align='center', out.width = "50%"}
duracion <- bicicletas$duracion_recorrido/60
summary(duracion)
boxplot(distancia, horizontal = TRUE, outline = FALSE,
        main = "DURACION DE LOS RECORRIDOS DE ECOBICI\nCABA 2020",
        sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
        cex.sub = 0.9,
        xlab = "Duración en horas", boxfill = "pink")
```

## Variable cantidad de viajes por usuario

Vamos a mostrar la cantidad de viajes por usuarios con un grafico de baras

``` {r viajes, fig.align='center', out.width = "50%"}
viajes <- table(bicicletas$id_usuario)
View(viajes)
View(table(viajes))
plot(table(viajes), 
     main = "CANTIDAD DE VIAJES POR USUARIO\nCABA 2020",
     sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
     cex.sub = 0.9,
     ylim = c(0,100), xlab = c("Viajes") ,ylab = c("Cantidad de Usuarios"))
```

# Análisis bivariado

``` {r bivar, fig.align='center', out.width = "50%"}
edad <- bicicletas$edad_usuario

agrupar <- function(x){
  if (x <= 21) {
    return ("[16-21]")
  } else if(x <= 30) {
    return ("[22-30]")
  } else if(x <= 45){
    return ("[30-45]")
  } else if(x <= 72){
    return("[45-72]")
  }
}

edad <- sapply(edad,agrupar)


distancia <- bicicletas$distancia/1000

bivar <- data.frame(edad,distancia)

bivar$edad <- factor(bivar$edad, levels = c("[16-21]","[22-30]","[30-45]","[45-72]"))


boxplot((bivar$distancia)~(bivar$edad), horizontal = TRUE, outline = FALSE,
        main = "DISTANCIA RECORRIDA SEGUN LA EDAD DEL USUARIO\nCABA 2020",
        sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
        cex.sub = 0.9,
        ylab = "Rango Hetario",
        xlab = "Distancia en KM", boxfill = "pink")
```