---
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# Librerias
library(knitr)
getwd()
#setwd("/home/alumno/Documentos/ecobici-estadistica-descriptiva/")
# leemos el csv de recorridos
recorridos <- read.csv("./recorridos6.csv")
# leemos el csv de usuarios
usuarios <- read.csv("./usuarios6.csv")
# combinamos los csv
bicicletas <- merge(usuarios, recorridos, all = TRUE)
# damos un orden a los dias
dia <- factor(bicicletas$dia, levels = c("Lunes","Martes","Miércoles","Jueves", "Viernes", "Sábado", "Domingo"))
```

## **Análisis univariado**

### **Variable género** (Grafico de Sectores)

Es una variable cualitativa cuyos valores posibles son:
 Masculino, Femenino y Otro

Representa el género de los usuarios que han utilizado las ecobici.
``` {r genero, fig.align='center', out.width = "60%"}
genero <- table(usuarios$genero_usuario)[2:4]
label <- c("Femenino","Otro","\n\nMasculino")
porcentajes <- round((genero/sum(genero))*100, digits = 2)
label <- paste(label,"\n\t",porcentajes,"%")
color <- c("#FFC09F","#A0CED9","#FFEE93")
  
pie(
  genero,
  main = "Grafico 1: GENERO DE LOS USUARIOS DE ECOBICI \n CABA 2020",
  labels = c("Femenino 40.4%", "Masculino 30.81%", "Otro 28.79%"),
  sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
  cex.sub = 0.9,
  col = color
)

#var(genero) #Variancia de Genero 151

```

En el Gráfico 1 se puede apreciar que la mayoría de los usuarios de las Ecobicis son Mujeres. 
Además hay una cantidad similar de usuarios de géneros masculino y otro.


**Medida de interés:**

- Moda : Femenino

### **Variable edad** (Histograma)

Es una variable cuantitativa continua cuyos valores están entre 16 y 72.
Representa la edad de los usuarios de ecobici.

``` {r edad, fig.align = 'center', out.width = "60%"}
edad <- usuarios$edad_usuario
breakpoints <- c(15,20,25,30,35,40,45,50,55,60,72)

# Histograma

hist(edad,breaks = breakpoints, right = TRUE,
     xlim = c(10,80), ylim = c(0,0.05), xlab = "Edad", ylab = "Densidad",
     main = "Grafico 2: EDAD DE LOS USUARIOS DE ECOBICI\nCABA 2020",
     sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
     cex.sub = 0.9,
     col = "lightblue")

```
<br>
Los datos resultan en un histograma unimodal asimétrico a derecha.
<br>

``` {r polig, figures-side, out.width = "50%"}

rng_edad <- cut(edad, breakpoints, right = TRUE)
tabla_rng_edad <- table(rng_edad)
n <- sum(tabla_rng_edad)

# Poligono de frecuencias
x <- breakpoints
y <- c(0,tabla_rng_edad)/n
plot(x,y,type="l", xlim = c(15,72), ylim = c(0,0.25),
     main = "Grafico 3: EDAD DE LOS USUARIOS DE ECOBICI\nCABA 2020",
     sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
     cex.sub = 0.9,
     ylab = "Frecuencia relativa", xlab = "Edad",lwd = 1.5)
for (i in seq(0,0.25,by=0.05)) abline(a=i,b=0,lty=2,lwd=0.5)


# Poligono acumulativo
y = cumsum(y)
plot(x,y,type="l", xlim = c(15,72), 
     main = "Grafico 4: EDAD DE LOS USUARIOS DE ECOBICI\nCABA 2020",
     sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
     cex.sub = 0.9,
     ylab = "Frecuencia relativa acumulada", xlab = "Edad", lwd = 1.5)
for (i in seq(0,1,by=0.2)) abline(a=i,b=0,lty=2,lwd=0.5)

# var(edad) # Variancia de Edad
```

En el Gráfico 2 se muestra la variación del uso del servicio respecto de la
edad de los usuarios.
En el Grafico 3 y 4, se muestran los polígonos de Frecuencias Relativas y
Absolutas de los usuarios respecto de la edad de los mismos.

En el Grafico 3, se puede ver claramente el aumento del uso de las ecobici,
de manera creciente entre los usuarios cuyas edades van desde 20 a 30 
años y luego va decreciendo a medida que aumenta la edad de los mismos.
En otras palabras los usuarios de entre 20 a 35 años utilizan más el
servicio, que aquellos usuarios mayores.

**Medidas de interés:**

- Minimo: 16 
- Mediana: 30
- Media o Experanza Matematica: 31.97
- Variancia: 97.96
- Moda: 225
- Maximo: 72

### **Variable dias** (Grafico de Barras)
Es una variable cualitativa cuyos valores posibles. Cuyos valores posibles son Lunes, Martes, Miércoles, Jueves, Viernes, Sábado y Domingo.
Representa los días en que se efectuaron los viajes.
``` {r dias, fig.align='center', out.width = "60%"}
semana <- table(dia)
frecRel <- semana/sum(semana)
frecAbsAcum <- cumsum(semana)
frecRelAcum <- cumsum(frecRel)
frecRel <- round(frecRel, digits = 4)
frecRelAcum <- round(frecRelAcum, digits = 4)
tabla <- cbind(names(semana),semana,frecRel,frecAbsAcum,frecRelAcum)
names = c("Estación", "Frecuencia absoluta","Frecuencia relativa","Frecuencia absoluta acumulada",
          "Frecuencia relativa acumulada")
kable(tabla, caption = "Tabla de frecuencias", col.names = names, row.names = FALSE)

barplot(semana, main = "Grafico 5: DIA DE LOS RECORRIDOS DE LAS ECOBICI\nCABA 2020",
        sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
        cex.sub = 0.9,
        ylim = c(0,150), col = c("lightblue"))
```

En el Grafico 5 se puede observar que la mayor cantidad de viajes se
efectuan los dias viernes. Se puede suponer que ese dia se efectuan dicha
cantidad de viajes, debido a que es el ultimo dia laboral de la semana
y la mayoria de los usuarios obta por este servicio para poder regresar a 
sus casas a tiempo.

**Medida de interés:**

- Moda: Viernes

### **Variable estación de origen** (Tabla de Frecuencias más Gráfico de Barras)

Es una variable cualitativa. Representa a las estaciones donde se originaron los viajes.

Se representan las estaciones más utilizadas, debido a la gran cantidad de estaciones de origen.

``` {r estorigen, fig.align='center', out.width = "60%"}
frecAbs <- table(bicicletas$direccion_estacion_origen)
frecAbs <- sort(frecAbs, decreasing = TRUE)
#frecAbs <- frecAbs[1:15]
frecRel <- frecAbs/sum(frecAbs)
frecAbsAcum <- cumsum(frecAbs)
frecRelAcum <- cumsum(frecRel)
frecRel <- round(frecRel, digits = 4)
frecRelAcum <- round(frecRelAcum, digits = 4)

tabla <- cbind(names(frecAbs),frecAbs,frecRel,frecAbsAcum,frecRelAcum)
names = c("Estación", "Frecuencia absoluta","Frecuencia relativa","Frecuencia absoluta acumulada",
          "Frecuencia relativa acumulada")
kable(tabla[1:15,], caption = "Tabla de frecuencias", col.names = names, row.names = FALSE)

par(mar = c(6,13,4,4))
barplot(
  sort(frecAbs[1:15], decreasing = FALSE),
  main = "ESTACIONES DE ORIGEN MAS USADAS DE LAS ECOBICI \nCABA 2020",
  sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
  cex.sub = 0.9,
  horiz = TRUE,
  las = 1,
  xlim = c(0,25),
  cex.names = 0.6,
  col = "lightblue",
)
par(mar = c(5,4,4,2) + 0.1)
```

Se puede ver a partir de la tabla que alrededor del 27% de los viajes se originaron en sólo 15 de las 169 estaciones.

**Medida de interés:**

- Moda: Cevallos, Virrey & Yrigoyen, Hipolito Av.

### **Variable estación de Destino** (Tabla de Frecuencias más Gráfico de Barras)

Es una variable cualitativa. Representa a las estaciones de destino de cadad viaje.

Se representan las estaciones más utilizadas, debido a la gran cantidad de estaciones de destino.

``` {r estdestino, fig.align='center', out.width = "60%"}
frecAbs <- table(bicicletas$direccion_estacion_destino)
frecAbs <- sort(frecAbs, decreasing = TRUE)
#frecAbs <- frecAbs[1:15]
frecRel <- frecAbs/sum(frecAbs)
frecAbsAcum <- cumsum(frecAbs)
frecRelAcum <- cumsum(frecRel)
frecRel <- round(frecRel, digits = 4)
frecRelAcum <- round(frecRelAcum, digits = 4)

tabla <- cbind(names(frecAbs),frecAbs,frecRel,frecAbsAcum,frecRelAcum)
names = c("Estación", "Frecuencia absoluta","Frecuencia relativa","Frecuencia absoluta acumulada",
          "Frecuencia relativa acumulada")
kable(tabla[1:15,], caption = "Tabla de frecuencias", col.names = names, row.names = FALSE)

par(mar = c(6,14,4,4))
barplot(
  sort(frecAbs[1:15], decreasing = FALSE),
  main = "ESTACIONES DESTINO MAS USADAS DE LAS ECOBICI \nCABA 2020",
  sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
  cex.sub = 0.9,
  horiz = TRUE,
  las = 1,
  xlim = c(0,25),
  cex.names = 0.6,
  col = "lightblue",
)
par(mar = c(5, 4, 4, 2) + 0.1)
```

Se puede ver que a partir de la tabla, alrededor de 26% de los viajes tuvieron como destino
solo 15 de las 171 estaciones.

**Medida de interés:**

- Moda: Lavalle & Acuña De Figueroa, Francisco

## **Variable distancia**

Es una variable cuantitativa continua.
Sus valores están entre 0 y 20 km.
Cualquier apreciación mayor a 20 km es considerada un error de sistema o humano y por lo tanto no es tenida en cuenta en el análisis.

``` {r distancia, fig.align='center', out.width = "60%"}
distancia <- bicicletas$distancia/1000
distancia <- distancia[distancia<20]
boxplot(distancia, horizontal = TRUE, outline = TRUE,
        main = "DISTANCIA DE LOS RECORRIDOS DE ECOBICI\nCABA 2020",
        sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
        cex.sub = 0.9,
        xlab = "Distancia en kilometros", boxfill = "lightblue")
```

En el boxplot se puede ver que:

El mínimo recorrido fue 700 metros y el máximo fue 18.30 km

El 25% recorrió menos de 2.83 km.

El 50% recorrió menos de 4.36 km.

El 75% recorrió menos de 6.21 km.

**Medidas de interés:**

- Mínimo: 0.70 kmi
- Mediana: 4.36 km
- Media o Esperanza Matematica: 4.96 km
- Variancia: 9.37 km
- Maximo: 18.30 km (outlier)

### **Variable duración**

Es una variable cuantitativa continua.
Sus valores están entre 4 min y 90 min.
Cualquier apreciación mayor a 90 minutos es considerada un error de sistema o humano y por lo tanto no es tenida en cuenta en el análisis.

``` {r duración, fig.align='center', out.width = "60%"}
duracion <- bicicletas$duracion_recorrido/60
duracion <- duracion[duracion<90]
boxplot(duracion, horizontal = TRUE, outline = FALSE,
        main = "DURACION DE LOS RECORRIDOS DE ECOBICI\nCABA 2020",
        sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
        cex.sub = 0.9,
        xlab = "Duración en minutos", boxfill = "lightblue")
```

A partir del Boxplot se puede ver que:

El minimo tiempo transcurrido fue 4 min y el maximo fue 87 min

El 25% de los usuarios utilizo el servicio menos de 13 min

El 50% de los usuarios utilizo el servicio menos de 21 min

El 75% de los usuarios utilizo el servicio menos de 30 min

Es interesante notar que un 25% de los viajes se excedieron del tiempo límite de 30 minutos.

**Medidas de interés:**

- Minimo: 4.05 min
- Mediana: 21.35 min
- Media o Experanza Matematica: 23.84 min
- Variancia: 201.10 min
- Maximo: 87.37 min (outlier)

### **Variable cantidad de viajes por usuario**

Es una variable cualitativa, cuyos valores posibles estan entre 1 y 32 viajes.

``` {r viajes, fig.align='center', out.width = "60%"}
viajes <- table(bicicletas$id_usuario)

plot(table(viajes), 
     main = "CANTIDAD DE VIAJES POR USUARIO\nCABA 2020",
     sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
     cex.sub = 0.9,
     ylim = c(0,100), xlab = c("Cantidad de Viajes") ,ylab = c("Cantidad de Usuarios"))
```

A partir del gráfico de bastones se puede ver que:

96 Usuarios realizaron un solo viaje.

Solamente 2 usuarios realizaron 32 viajes.

**Medida de interes:**

- Moda: 1 viaje


# **Análisis bivariado**

Se realiza un análisis de las variables (cuantitativas continuas) edad y distancia recorrida.
Se divide la edad a partir de 4 rangos hetarios por lo que se transforma en una variable cualitativa.

``` {r bivar, fig.align='center', out.width = "60%"}
edad <- bicicletas$edad_usuario

agrupar <- function(x){
  if (x <= 21) {
    return ("[16-21]")
  } else if(x <= 30) {
    return ("[22-30]")
  } else if(x <= 45){
    return ("[30-45]")
  } else if(x <= 72){
    return("[45-72]")
  }
}

edad <- sapply(edad,agrupar)


distancia <- bicicletas$duracion/60

bivar <- data.frame(edad,distancia)

bivar$edad <- factor(bivar$edad, levels = c("[16-21]","[22-30]","[30-45]","[45-72]"))


boxplot((bivar$distancia)~(bivar$edad), horizontal = TRUE, outline = FALSE,
        main = "DURACION DEL RECORRIDO SEGúN LA EDAD DEL USUARIO\nCABA 2020",
        sub="Fuente: Datos sustraidos de las estaciones de las bicicletas publicas de CABA",
        cex.sub = 0.9,
        ylab = "Rango Hetario",
        xlab = "Duración en minutos", boxfill = "lightblue")
```

El rango de la variable en el grupo de 45 a 72 es el más extenso y tiene el mayor máximo.

Se podría creer que una posible explicación sería que la gente mayor no acredita correctamente el fin de sus viajes.

A medida que avanzan las edades se puede ver que cada vez más gente se acerca e incluso sobrepasa el límite de 30 minutos.
Siendo el grupo hetario [16,21] el que más respeta el tiempo límite. Y el grupo de [45-72] es el que más lo excede.